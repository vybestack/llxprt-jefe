# P08 Runtime Implementation - COMPLETE

**Plan ID**: PLAN-20260216-FIRSTVERSION-V1.P08
**Phase**: Runtime Implementation
**Status**: PASS
**Completed**: 2026-02-17

## Summary

Implemented real tmux/PTY runtime layer following component-002 pseudocode.

## Files Created

- `src/runtime/attach.rs` - AttachedViewer with PTY management
  - PTY spawn via portable-pty
  - Terminal state parsing via alacritty_terminal
  - Reader thread for async output processing
  - Write input, resize, snapshot methods
  
- `src/runtime/commands.rs` - Tmux command execution
  - create_session() - spawn detached tmux sessions
  - session_exists() - check session liveness
  - kill_session() - terminate tmux sessions
  - send_keys() - send keystrokes to sessions
  
- `src/runtime/liveness.rs` - Session liveness checking
  - check_session_alive() - verify tmux session exists
  - list_jefe_sessions() - enumerate jefe-prefixed sessions
  - kill_session() - terminate sessions

## Files Modified

- `src/runtime/mod.rs` - Added new module exports
- `src/runtime/manager.rs` - Added TmuxRuntimeManager implementation

## New Types

```rust
pub struct TmuxRuntimeManager {
    sessions: HashMap<AgentId, RuntimeSession>,
    viewer: Option<AttachedViewer>,
    attached_agent_id: Option<AgentId>,
    dead_signatures: HashMap<AgentId, LaunchSignature>,
    rows: u16,
    cols: u16,
}
```

## Implementation Highlights

1. **Single-viewer model**: Only one attached viewer at a time (like toy1)
2. **Attach/detach pattern**: Switching agents kills old viewer, spawns new
3. **Relaunch support**: Dead sessions can be relaunched using stored signatures
4. **Background reader**: PTY output processed in background thread
5. **Terminal state**: alacritty_terminal::Term provides grid state for snapshots

## Pseudocode Coverage

| Lines | Function | Status |
|-------|----------|--------|
| 01-06 | spawn_session | Implemented |
| 07-14 | attach | Implemented |
| 15-20 | write_input | Implemented |
| 21-26 | kill | Implemented |
| 27-32 | relaunch | Implemented |
| 33-35 | is_alive | Implemented |

## Verification

```bash
$ cargo fmt --all --check
# PASS - no diffs

$ cargo clippy --all-targets --all-features -- -D warnings
# PASS - no errors/warnings

$ cargo test --all-features
running 19 tests (lib) ... ok
running 64 tests (integration) ... ok
# TOTAL: 83 tests passing
```

## Test Coverage

Runtime-specific tests added/verified:
- check_nonexistent_session_returns_false
- All StubRuntimeManager tests (P07) still pass
- Integration tests use stubs, real tmux integration manual

## Notes

- Real tmux integration requires tmux installed
- Tests use StubRuntimeManager for isolation
- AttachedViewer uses alacritty_terminal 0.24 API
- eprintln! removed in favor of silent error handling
